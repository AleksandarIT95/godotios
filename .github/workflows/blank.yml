name: iOS Export

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: macos-latest

    steps:
      - uses: actions/checkout@v2

      - name: Install Godot
        uses: godotengine/setup-godot@v1
        with:
          godot-version: '3.3.3'

      - name: Install Xcode
        run: sudo xcode-select --install

      - name: Install iOS Dependencies
        run: sudo xcode-select --switch /Applications/Xcode.app/Contents/Developer && sudo xcodebuild -runFirstLaunch

      - name: Install iOS Plugins
        run: godot --gdnative-generate-json-api && godot --gdnative-generate-gir-api

      - name: Export Game for iOS
        run: godot --export "iOS" /path/to/export/dir

